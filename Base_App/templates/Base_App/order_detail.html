{% extends "Base_App/base.html" %}

{% load static %}

{% block class %}class="sub_page"{% endblock class %}

{% block extra_css %}
    <link href="{% static 'css/order_detail.css' %}" rel="stylesheet" />
{% endblock extra_css %}

{% block main %}
    <!-- Order Details Section -->
    <section class="layout_padding py-4 py-md-5">
        <div class="container-fluid px-3 px-md-4">
            <div class="row justify-content-center">
                <div class="col-12 col-lg-10 col-xl-8">
                    <!-- Page Header with Breadcrumb -->
                    <div class="mb-4 px-2">
                        <h1 class="h2 mb-2 fw-bold text-dark">Order Details</h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="{% url 'Home' %}" class="text-decoration-none">Home</a>
                                </li>
                                <li class="breadcrumb-item">
                                    <a href="{% url 'order_history' %}" class="text-decoration-none">Order History</a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">Order #{{ order.order_number }}</li>
                            </ol>
                        </nav>
                    </div>

                    <!-- Main Order Details Card -->
                    <div class="card border-0 shadow-sm overflow-hidden mx-2 mx-md-0">
                        <!-- Card Header - Fixed visibility with better contrast -->
                        <div class="card-header bg-primary text-white py-3 py-md-4 px-3 px-md-4">
                            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                                <div class="mb-2 mb-md-0">
                                    <!-- Order number with clear visibility -->
                                    <h3 class="h4 mb-1 fw-bold text-white">Order #{{ order.order_number }}</h3>
                                    <p class="mb-0 text-white-80">
                                        {{ order.created_at|date:"F j, Y g:i A" }}
                                    </p>
                                </div>
                                <!-- Order status badges with improved styling -->
                                <div class="d-flex flex-wrap gap-2">
                                    <span class="badge fs-6 px-2 px-md-3 py-1 py-md-2 
                                        {% if order.status == 'completed' %}bg-success text-white
                                        {% elif order.status == 'cancelled' %}bg-danger text-white
                                        {% else %}bg-warning text-dark{% endif %}">
                                        {{ order.get_status_display }}
                                    </span>
                                    <span class="badge fs-6 px-2 px-md-3 py-1 py-md-2 
                                        {% if order.payment_status == 'paid' %}bg-success text-white
                                        {% else %}bg-light text-dark{% endif %}">
                                        {{ order.get_payment_status_display }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <!-- Card Body -->
                        <div class="card-body p-3 p-md-4">
                            <!-- Customer & Order Information Section -->
                            <div class="row g-3 g-md-4 mb-4">
                                <!-- Customer Information Card -->
                                <div class="col-12 col-md-6">
                                    <div class="card h-100 border-light shadow-sm">
                                        <div class="card-header bg-light py-2 py-md-3">
                                            <h5 class="mb-0 text-dark fs-6 fs-md-5">
                                                <i class="fas fa-user-circle me-2 text-primary"></i>
                                                Customer Information
                                            </h5>
                                        </div>

                                        <div class="card-body">
                                            <div class="mb-2 mb-md-3">
                                                <strong class="text-muted d-block small">Name:</strong>
                                                <span class="text-dark">
                                                    {{ order.customer_name }}
                                                </span>
                                            </div>
                                            <div class="mb-2 mb-md-3">
                                                <strong class="text-muted d-block small">Email:</strong>
                                                <span class="text-dark">
                                                    {{ order.customer_email }}
                                                </span>
                                            </div>
                                            <div class="mb-2 mb-md-3">
                                                <strong class="text-muted d-block small">Phone:</strong>
                                                <span class="text-dark">
                                                    {{ order.customer_phone }}
                                                </span>
                                            </div>
                                            {% if order.customer_address %}
                                                <div class="mb-0">
                                                    <strong class="text-muted d-block small">Address:</strong>
                                                    <span class="text-dark">
                                                        {{ order.customer_address }}
                                                    </span>
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- Order Information Card -->
                                <div class="col-12 col-md-6">
                                    <div class="card h-100 border-light shadow-sm">
                                        <div class="card-header bg-light py-2 py-md-3">
                                            <h5 class="mb-0 text-dark fs-6 fs-md-5">
                                                <i class="fas fa-receipt me-2 text-primary"></i>
                                                Order Information
                                            </h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="mb-2 mb-md-3">
                                                <strong class="text-muted d-block small">
                                                    Order Date:
                                                </strong>
                                                <span class="text-dark">
                                                    {{ order.created_at|date:"F j, Y g:i A" }}
                                                </span>
                                            </div>
                                            <div class="mb-2 mb-md-3">
                                                <strong class="text-muted d-block small">Status:</strong>
                                                <span class="badge {% if order.status == 'completed' %}bg-success
                                                {% elif order.status == 'cancelled' %}bg-danger
                                                {% else %}bg-warning text-dark{% endif %}">
                                                    {{ order.get_status_display }}
                                                </span>
                                            </div>
                                            <div class="mb-0">
                                                <strong class="text-muted d-block small">Payment Status:</strong>
                                                <span class="badge {% if order.payment_status == 'paid' %}bg-success
                                                {% else %}bg-light text-dark{% endif %}">
                                                    {{ order.get_payment_status_display }}
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Order Items Section -->
                            <div class="card border-light shadow-sm mb-4">
                                <div class="card-header bg-light py-2 py-md-3">
                                    <h5 class="mb-0 text-dark fs-6 fs-md-5">
                                        <i class="fas fa-utensils me-2 text-primary"></i>
                                        Order Items
                                    </h5>
                                </div>
                                <div class="card-body p-0">
                                    <!-- Responsive table container with horizontal scrolling -->
                                    <div class="table-responsive order-table-container">
                                        <!-- Table with permanent borders and enhanced styling -->
                                        <table class="table table-bordered table-hover align-middle mb-0 order-detail-table">
                                            <thead class="table-light">
                                                <tr>
                                                    <!-- Table Headers with explicit border styling -->
                                                    <th scope="col" class="text-nowrap border-end ps-3 ps-md-4 text-dark fw-semibold">Item</th>
                                                    <th scope="col" class="text-center text-nowrap border-end text-dark fw-semibold">Quantity</th>
                                                    <th scope="col" class="text-end text-nowrap border-end text-dark fw-semibold">Unit Price</th>
                                                    <th scope="col" class="text-end text-nowrap pe-3 pe-md-4 text-dark fw-semibold">Subtotal</th>
                                                </tr>
                                            </thead>

                                            <tbody>
                                                <!-- Loop through each order item -->
                                                {% for item in order_items %}
                                                    <tr>
                                                        <!-- Item name with right border -->
                                                        <td class="text-nowrap border-end ps-3 ps-md-4">
                                                            <div class="d-flex align-items-center">
                                                                <div class="flex-grow-1">
                                                                    <h6 class="mb-0 text-dark fs-6">
                                                                        {{ item.item_name }}
                                                                    </h6>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <!-- Item quantity, centered with right border -->
                                                        <td class="text-center border-end">
                                                            <span class="badge bg-secondary text-white rounded-pill px-2 px-md-3 py-1 py-md-2">
                                                                {{ item.quantity }}
                                                            </span>
                                                        </td>
                                                        <!-- Individual item price, right-aligned with right border -->
                                                        <td class="text-end border-end text-dark">${{ item.final_price|floatformat:2 }}</td>
                                                        <!-- Item subtotal (quantity x price), right-aligned -->
                                                        <td class="text-end pe-3 pe-md-4 text-dark">${{ item.subtotal|floatformat:2 }}</td>
                                                    </tr>
                                                {% empty %}
                                                    <!-- Empty state row -->
                                                    <tr>
                                                        <td colspan="4" class="text-center py-4 text-muted border-top">
                                                            <i class="fas fa-shopping-basket fa-2x mb-2 d-block"></i>
                                                            No items found in this order.
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            </tbody>

                                            <tfoot class="table-group-divider">
                                                <!-- Order total row with top border -->
                                                <tr class="border-top">
                                                    <td colspan="3" class="text-end border-end fw-bold ps-3 ps-md-4 text-dark">
                                                        Total:
                                                    </td>
                                                    <td class="text-end fw-bold fs-5 text-success pe-3 pe-md-4">
                                                        ${{ order.final_total|floatformat:2 }}
                                                    </td>
                                                </tr>
                                            </tfoot>
                                        </table>
                                    </div>
                                    <!-- /End of table-responsive -->
                                </div>
                            </div>

                            <!-- Special Instructions Section (conditional display) -->
                            {% if order.special_instructions %}
                                <div class="card border-warning shadow-sm mb-4">
                                    <div class="card-header bg-warning bg-opacity-10 py-2 py-md-3">
                                        <h5 class="mb-0 text-warning fs-6 fs-md-5">
                                            <i class="fas fa-sticky-note me-2"></i>
                                            Special Instructions
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="mb-0 text-dark">
                                            {{ order.special_instructions }}
                                        </p>
                                    </div>
                                </div>
                            {% endif %}

                            <!-- Action Buttons Section -->
                            <div class="d-flex flex-column flex-sm-row gap-2 gap-md-3 justify-content-between align-items-start align-items-sm-center pt-3 border-top">
                                <div class="order-2 order-sm-1 w-100 w-sm-auto">
                                    <a href="{% url 'order_history' %}" class="btn btn-outline-secondary w-100 w-sm-auto">
                                        <i class="fas fa-arrow-left me-2"></i>
                                        Back to Order History
                                    </a>
                                </div>
                                <div class="order-1 order-sm-2 w-100 w-sm-auto mb-2 mb-sm-0">
                                    <a href="{% url 'Home' %}" class="btn btn-primary w-100 w-sm-auto">
                                        <i class="fas fa-home me-2"></i> Back to Home
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /End of Main Card -->
                </div>
            </div>
        </div>
    </section>
{% endblock main %}